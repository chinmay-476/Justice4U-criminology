<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title if title else "ITSupport Management System" }}</title>
  
  <!-- PWA Meta Tags -->
  <meta name="description" content="A comprehensive criminology and criminal record management system">
  <meta name="theme-color" content="#2a5298">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="CriminologyMS">
  <meta name="msapplication-TileColor" content="#1e3c72">
  <meta name="msapplication-tap-highlight" content="no">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  
  <!-- PWA Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='images/icon-192x192.png') }}">
  <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='images/icon-512x512.png') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/icon-192x192.png') }}">
  
  <!-- Additional PWA Meta Tags -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="CriminologyMS">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap/dist/css/bootstrap.min.css">
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='base.css') }}">
  
  <!-- Fixed Navbar and Layout Styles -->
  <style>
    /* Fixed navbar positioning */
    .main-header {
        position: fixed !important;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1030;
        width: 100%;
    }

    /* Adjust content wrapper to account for fixed navbar */
    .content-wrapper {
        margin-top: 56px !important;
        min-height: calc(100vh - 56px);
        margin-left: 0 !important;
        padding-left: 0 !important;
    }

    /* Fix footer positioning */
    .main-footer {
        position: relative;
        margin-top: auto;
        margin-left: 250px !important;
        transition: all 0.3s ease;
    }

    /* Footer when sidebar is collapsed */
    .sidebar-collapse + .content-wrapper .main-footer {
        margin-left: 0 !important;
    }

    /* Ensure proper spacing for the page content */
    .wrapper {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        margin-left: 0 !important;
        padding-left: 0 !important;
    }

    /* Adjust sidebar positioning */
    .main-sidebar {
        position: fixed !important;
        top: 56px;
        height: calc(100vh - 56px);
        left: 0;
        z-index: 1020;
        width: 250px;
        transition: all 0.3s ease;
    }

    /* Sidebar collapsed state */
    .main-sidebar.sidebar-collapse {
        margin-left: -250px;
    }

    /* Content area adjustments - responsive to sidebar state */
    .content {
        margin-left: 250px !important;
        padding-left: 15px !important;
        padding-right: 15px !important;
        padding-top: 0;
        width: calc(100% - 250px);
        transition: all 0.3s ease;
    }

    /* Content when sidebar is collapsed */
    .sidebar-collapse + .content-wrapper .content {
        margin-left: 0 !important;
        width: 100% !important;
    }

    /* Content header adjustments */
    .content-header {
        margin-left: 250px !important;
        padding-left: 15px !important;
        padding-right: 15px !important;
        transition: all 0.3s ease;
    }

    /* Content header when sidebar is collapsed */
    .sidebar-collapse + .content-wrapper .content-header {
        margin-left: 0 !important;
    }

    /* Container fluid adjustments */
    .container-fluid {
        padding-left: 15px !important;
        padding-right: 15px !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }

    /* Card adjustments */
    .card {
        margin-left: 0 !important;
        margin-right: 0 !important;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .content {
            margin-left: 0 !important;
            width: 100% !important;
            padding-left: 10px !important;
            padding-right: 10px !important;
        }
        
        .content-header {
            margin-left: 0 !important;
            padding-left: 10px !important;
            padding-right: 10px !important;
        }
        
        .container-fluid {
            padding-left: 10px !important;
            padding-right: 10px !important;
        }
        
        .main-sidebar {
            top: 56px;
            margin-left: -250px; /* Hide sidebar by default on mobile */
        }
        
        .main-sidebar.show {
            margin-left: 0; /* Show sidebar when toggled on mobile */
        }
        
        .content-wrapper {
            margin-left: 0 !important;
        }
        
        .main-footer {
            margin-left: 0 !important;
        }
    }

    /* Additional fixes for better alignment */
    .row {
        margin-left: 0 !important;
        margin-right: 0 !important;
    }

    .col-md-12, .col-sm-6, .col-sm-12 {
        padding-left: 15px !important;
        padding-right: 15px !important;
    }

    /* Remove any unwanted margins from body */
    body {
        margin: 0 !important;
        padding: 0 !important;
    }

    /* Additional layout fixes */
    .main-header .navbar-nav {
        margin-left: 0 !important;
    }

    /* Ensure proper content alignment */
    .content-wrapper > .content {
        margin-left: 250px !important;
        padding: 15px !important;
    }

    /* Fix any Bootstrap container issues */
    .container-fluid {
        max-width: 100% !important;
    }

    /* Ensure cards take full width of their container */
    .card {
        width: 100% !important;
        max-width: 100% !important;
    }

    /* Fix table responsiveness */
    .table-responsive {
        margin: 0 !important;
        padding: 0 !important;
    }

    /* Ensure proper spacing for pagination */
    .pagination {
        margin: 0 !important;
    }

    /* Fix any AdminLTE specific issues */
    .content-wrapper {
        background-color: #f4f4f4;
    }

    /* Ensure sidebar doesn't interfere with content */
    .main-sidebar {
        box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  
  

  <div class="wrapper">
    <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button" title="Toggle Sidebar">
          <i class="fas fa-bars" id="sidebar-toggle-icon"></i>
        </a>
      </li>
    </ul>
    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <span class="navbar-text">
          <small id="sidebar-status">Sidebar: Open</small>
        </span>
      </li>
    </ul>
  </nav>
    <!-- Sidebar -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <div class="sidebar">
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="info">
          <a href="#" class="d-block">Super Admin</a>
        </div>
      </div>

      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview">

          <!-- MANAGE USERS -->
          <li class="nav-item menu-open">
            <a href="#" class="nav-link active">
              <i class="fas fa-users"></i>
              <p>MANAGE USERS <i class="right fas fa-angle-left"></i></p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="{{ url_for('department') }}" class="nav-link"><i class="far fa-circle nav-icon"></i>Department</a>
              </li>
              
              <li class="nav-item">
                <a href="{{ url_for('it_team_details') }}" class="nav-link"><i class="far fa-circle nav-icon"></i>Admin Team</a>
              </li>
              <li class="nav-item">
                <a href="{{ url_for('user_change_password') }}" class="nav-link"><i class="far fa-circle nav-icon"></i>Change Password</a>
              </li>
            </ul>
          </li>

          <!-- Admin-only links removed from base layout -->
          <!-- Please see templates/admin_base.html for admin navigation -->

          <!-- MY SETTING -->
          

        </ul>
      </nav>
    </div>
  </aside>

  <!-- Page Content -->
  <div class="content-wrapper flex-grow-1 p-4">
    {% block content %}{% endblock %}
  </div>
  <footer class="main-footer">
  <strong>
    Copyright &copy; 2014-2021
    <a href="https://adminlte.io">AdminLTE.io</a>.
  </strong>
  All rights reserved.
  <div class="float-right d-none d-sm-inline-block">
    <b>Version</b> 3.2.0
  </div>
</footer>
  </div>
  
  <!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap Bundle (JS + Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<!-- Sidebar Toggle Script -->
<script>
  $(document).ready(function () {
    // Sidebar toggle functionality
    $('[data-widget="pushmenu"]').on('click', function (e) {
      e.preventDefault();
      $('.main-sidebar').toggleClass('sidebar-collapse');
      
      // Toggle content width and update status
      if ($('.main-sidebar').hasClass('sidebar-collapse')) {
        $('.content').css({
          'margin-left': '0',
          'width': '100%'
        });
        $('.content-header').css({
          'margin-left': '0'
        });
        $('.main-footer').css({
          'margin-left': '0'
        });
        $('#sidebar-status').text('Sidebar: Closed');
        $('#sidebar-toggle-icon').removeClass('fa-bars').addClass('fa-chevron-right');
      } else {
        $('.content').css({
          'margin-left': '250px',
          'width': 'calc(100% - 250px)'
        });
        $('.content-header').css({
          'margin-left': '250px'
        });
        $('.main-footer').css({
          'margin-left': '250px'
        });
        $('#sidebar-status').text('Sidebar: Open');
        $('#sidebar-toggle-icon').removeClass('fa-chevron-right').addClass('fa-bars');
      }
    });

    // Mobile sidebar toggle
    $(window).resize(function() {
      if ($(window).width() <= 768) {
        $('.main-sidebar').removeClass('sidebar-collapse');
        $('.content').css({
          'margin-left': '0',
          'width': '100%'
        });
        $('.content-header').css({
          'margin-left': '0'
        });
        $('.main-footer').css({
          'margin-left': '0'
        });
      } else {
        // On desktop, restore sidebar state
        if (!$('.main-sidebar').hasClass('sidebar-collapse')) {
          $('.content').css({
            'margin-left': '250px',
            'width': 'calc(100% - 250px)'
          });
          $('.content-header').css({
            'margin-left': '250px'
          });
          $('.main-footer').css({
            'margin-left': '250px'
          });
        }
      }
    });

    // Close sidebar when clicking outside on mobile
    $(document).on('click', function(e) {
      if ($(window).width() <= 768) {
        if (!$(e.target).closest('.main-sidebar, [data-widget="pushmenu"]').length) {
          $('.main-sidebar').removeClass('show');
        }
      }
    });
  });
</script>

<!-- PWA Service Worker Registration -->
<script>
  // Register service worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('{{ url_for("static", filename="service-worker.js") }}')
        .then(function(registration) {
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
          
          // Check for updates
          registration.addEventListener('updatefound', function() {
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', function() {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                // New content is available, show update notification
                if (confirm('New version available! Click OK to update.')) {
                  newWorker.postMessage({ type: 'SKIP_WAITING' });
                  window.location.reload();
                }
              }
            });
          });
        })
        .catch(function(err) {
          console.log('ServiceWorker registration failed: ', err);
        });
    });
  }

  // Handle PWA install prompt
  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
    // Prevent Chrome 67 and earlier from automatically showing the prompt
    e.preventDefault();
    // Stash the event so it can be triggered later
    deferredPrompt = e;
    
    // Show install button or notification
    showInstallButton();
  });

  function showInstallButton() {
    // Create install button
    const installButton = document.createElement('button');
    installButton.innerHTML = 'ðŸ“± Install App';
    installButton.className = 'btn btn-primary position-fixed';
    installButton.style.cssText = 'bottom: 20px; right: 20px; z-index: 9999; box-shadow: 0 4px 8px rgba(0,0,0,0.3);';
    installButton.onclick = installApp;
    
    document.body.appendChild(installButton);
    
    // Auto-hide after 10 seconds
    setTimeout(() => {
      if (installButton.parentNode) {
        installButton.parentNode.removeChild(installButton);
      }
    }, 10000);
  }

  function installApp() {
    if (deferredPrompt) {
      // Show the install prompt
      deferredPrompt.prompt();
      
      // Wait for the user to respond to the prompt
      deferredPrompt.userChoice.then((choiceResult) => {
        if (choiceResult.outcome === 'accepted') {
          console.log('User accepted the install prompt');
        } else {
          console.log('User dismissed the install prompt');
        }
        deferredPrompt = null;
      });
    }
  }

  // Handle app installed event
  window.addEventListener('appinstalled', (evt) => {
    console.log('App was installed');
    // Hide install button if it exists
    const installButton = document.querySelector('button[onclick="installApp()"]');
    if (installButton) {
      installButton.parentNode.removeChild(installButton);
    }
  });
</script>
</body>
</html>